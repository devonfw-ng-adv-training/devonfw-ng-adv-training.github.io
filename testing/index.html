<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>Angular Advanced - Testing</title>

    <link href="https://fonts.googleapis.com/css?family=Ubuntu" rel="stylesheet">

    <link rel="icon" href="../common/img/favicon.ico">

    <link rel="stylesheet" href="../reveal.js-3.6.0/css/reveal.css">
    <link rel="stylesheet" href="../reveal.js-3.6.0/css/theme/white.css">
    <link rel="stylesheet" href="../common/css/common.css">

    <!-- Theme used for syntax highlighting of code -->
    <link rel="stylesheet" href="../reveal.js-3.6.0/lib/css/zenburn.css">

    <!-- Printing and PDF exports -->
    <script>
        var link = document.createElement('link');
        link.rel = 'stylesheet';
        link.type = 'text/css';
        link.href = window.location.search.match(/print-pdf/gi) ? '../reveal.js-3.6.0/css/print/pdf.css' : '../reveal.js-3.6.0/css/print/paper.css';
        document.getElementsByTagName('head')[0].appendChild(link);
    </script>
    <style>
        .ng-universal {
            --bg-color: var(--cap-white);
            --link-color: var(--cap-gray);
        }

        code:not(.hljs) {
            color: var(--cap-gray);
        }
    </style>
</head>

<body class="ng-universal">
<div class="devon reveal">
    <div class="slides">
        <section data-background-image="../common/img/shapes/Fixed_Shape_2_SVG/Fixed_Shape_2_CapgeminiBlue_RGB.svg">
            <h3 class="white">Unit Testing</h3>
            <h4 class="white">March 2019 State</h4>
        </section>

        <section id="agenda-1" data-transition="slide"
                 data-background-image="../common/img/shapes/Fixed_Shape_2_SVG/Fixed_Shape_2_CapgeminiBlue_RGB.svg">
            <h2 class="white">Agenda</h2>

            <body class="white">
            <ul>
                <li>
                    <a href="#/basics">Basics</a>
                </li>
                <li>
                    <a href="#/child-components">Child components</a>
                </li>
                <li>
                    <a href="#/async">Testing asynchronous code</a>
                </li>
                <li>
                    <a href="#/pacts">Pact</a>
                </li>
                <!--<li>-->
                <!--<a href="#/router-events">Testing router events</a>-->
                <!--</li>-->

            </ul>
            </body>
        </section>

        <!-- Basics -->
        <section>
            <section id="basics" data-transition="slide"
                     data-background-image="../common/img/shapes/Fixed_Shape_2_SVG/Fixed_Shape_2_CapgeminiBlue_RGB.svg">
                <h2 class="white">Preparation</h2>

                <body class="white">
                <a href="https://github.com/devonfw-ng-adv-training/defonfw-testing">
                    https://github.com/devonfw-ng-adv-training/defonfw-testing</a>
                </body>
            </section>
            <section data-transition="slide"
                     data-background-image="../common/img/shapes/Fixed_Shape_2_SVG/Fixed_Shape_2_CapgeminiBlue_RGB.svg">
                <h2 class="white">Basics</h2>

                <body class="white">
                <ul>
                    <li>
                        more isolated testing
                    </li>
                    <li>
                        strongly typed template checking
                    </li>
                    <li>
                        less coupling between components and services
                    </li>
                    <li>
                        prefer dumb components over smart components
                    </li>
                </ul>
                </body>
            </section>
            <section data-transition="slide"
                     data-background-image="../common/img/shapes/Fixed_Shape_2_SVG/Fixed_Shape_2_CapgeminiBlue_RGB.svg">
                <h2 class="white">Basics / jasmine</h2>

                <body class="white">
                <ul>
                    <li>
                        suites: describe(string, function)
                    </li>
                    <li>
                        specs: it(string, function)
                    </li>
                    <li>
                        expectations: expect(actual)...
                    </li>
                    <li>
                        matchers: toBe(expected), toEqual(expected)...
                    </li>
                </ul>
                </body>
            </section>
            <section data-transition="slide"
                     data-background-image="../common/img/shapes/Fixed_Shape_2_SVG/Fixed_Shape_2_CapgeminiBlue_RGB.svg">
                <h2 class="white">.. / setup & teardown</h2>

                <body class="white">
                <ul>
                    <li>
                        beforeAll
                    </li>
                    <li>
                        beforeEach
                    </li>
                    <li>
                        afterEach
                    </li>
                    <li>
                        afterAll
                    </li>
                </ul>
                </body>
            </section>
        </section>

        <!-- Child components -->
        <section>
            <section id="child-components" data-transition="slide"
                     data-background-image="../common/img/shapes/Fixed_Shape_2_SVG/Fixed_Shape_2_CapgeminiBlue_RGB.svg">
                <h2 class="white">Child Components</h2>

                <body class="white">
                <ul>
                    <li>
                        why?
                    </li>
                    <li>
                        more isolated testing
                    </li>
                    <li>
                        strongly typed template checking
                    </li>
                    <li>
                        less coupling between components and services
                    </li>
                    <li>
                        prefer dumb components over smart components
                    </li>
                </ul>
                </body>
            </section>
            <section data-transition="slide"
                     data-background-image="../common/img/shapes/Fixed_Shape_2_SVG/Fixed_Shape_2_CapgeminiBlue_RGB.svg">
                <h2 class="white">Child Components / declarations</h2>

                <body class="white">
                <ul>
                    <li>
                        Use real component
                    </li>
                    <li>
                        NO_ERRORS_SCHEMA
                    </li>
                    <li>
                        Mock component
                    </li>
                    <li>
                        use <a href="https://github.com/ike18t/ng-mocks">ng-mocks</a>
                    </li>
                </ul>
                </body>
            </section>

        </section>

        <!-- Async -->
        <section>
            <section id="async" data-transition="slide"
                     data-background-image="../common/img/shapes/Fixed_Shape_2_SVG/Fixed_Shape_2_CapgeminiBlue_RGB.svg">
                <h2 class="white">Testing asynchronous code</h2>

                <body class="white">
                <ul>
                    <li>
                        async
                    </li>
                    <li>
                        fakeAsync
                    </li>
                    <li>
                        done
                    </li>
                </ul>
                </body>
            </section>
            <section data-transition="slide"
                     data-background-image="../common/img/shapes/Fixed_Shape_2_SVG/Fixed_Shape_2_CapgeminiBlue_RGB.svg">
                <h3 class="white">async</h3>

                <body class="white">
                <pre style="margin: 0; width: 100%"><code class="hljs ts" data-trim>
it('should show quote after getQuote (async)', async(() => {
  fixture.detectChanges(); // ngOnInit()
  expect(quoteEl.textContent).toBe('...', 'should show placeholder');

  fixture.whenStable().then(() => { // wait for async getQuote
    fixture.detectChanges();        // update view with quote
    expect(quoteEl.textContent).toBe(testQuote);
    expect(errorMessage()).toBeNull('should not show error');
  });
}));
            </code></pre>

                <small>
                    <a href="https://angular.io/guide/testing#async-test-with-async">https://angular.io/guide/testing#async-test-with-async</a>
                </small>
                </body>
            </section>
            <section data-transition="slide"
                     data-background-image="../common/img/shapes/Fixed_Shape_2_SVG/Fixed_Shape_2_CapgeminiBlue_RGB.svg">
                <h3 class="white">fakeAsync</h3>

                <body class="white">
                <pre style="margin: 0; width: 100%"><code class="hljs ts" data-trim>
it('Button label via fakeAsync() and tick()', fakeAsync(() => {
  expect(el.nativeElement.textContent.trim()).toBe('');
  fixture.detectChanges();
  expect(el.nativeElement.textContent.trim()).toBe('Login');
  spyOn(authService, 'isAuthenticated').and
                    .returnValue(Promise.resolve(true));
  component.ngOnInit();

  tick();
  fixture.detectChanges();
  expect(el.nativeElement.textContent.trim()).toBe('Logout');
}));
            </code></pre>

                <small>
                    <a href="https://angular.io/guide/testing#async-test-with-fakeasync">https://angular.io/guide/testing#async-test-with-fakeasync</a>
                </small>
                </body>
            </section>
            <section data-transition="slide"
                     data-background-image="../common/img/shapes/Fixed_Shape_2_SVG/Fixed_Shape_2_CapgeminiBlue_RGB.svg">
                <h3 class="white">done</h3>

                <body class="white">
                <pre style="margin: 0; width: 100%"><code class="hljs ts" data-trim>
it('should show last quote (quote done)', (done: DoneFn) => {
  fixture.detectChanges();

  component.quote.pipe( last() ).subscribe(() => {
    fixture.detectChanges(); // update view with quote
    expect(quoteEl.textContent).toBe(testQuote);
    expect(errorMessage()).toBeNull('should not show error');
    done();
  });
});
            </code></pre>

                <small>
                    <a href="https://angular.io/guide/testing#jasmine-done">https://angular.io/guide/testing#jasmine-done</a>
                </small>
                </body>
            </section>
        </section>

        <!-- pact -->
        <section>
            <section id="pacts" data-transition="slide"
                     data-background-image="../common/img/shapes/Fixed_Shape_2_SVG/Fixed_Shape_2_CapgeminiBlue_RGB.svg">
                <h2 class="white">consumer-driven contract testing</h2>

                <body class="white">
                <ul>
                    <li>
                        consumer defines requirements
                    </li>
                    <li>
                        for an api of provider
                    </li>
                    <li>
                        via tests
                    </li>
                    <li>
                        generate contract via pact
                    </li>
                    <li>
                        provider tests all contract files in build pipeline
                    </li>
                </ul>
                </body>
            </section>
            <section data-transition="slide"
                     data-background-image="../common/img/shapes/Fixed_Shape_2_SVG/Fixed_Shape_2_CapgeminiBlue_RGB.svg">
                <h3 class="white">pact / interface</h3>

                <img height="300em" class="no-background no-border no-margin no-shadow"
                     src="./img/pact-basic-interface.JPG">
                <!--Image taken from FT Testing days presentation -->
            </section>
            <section data-transition="slide"
                     data-background-image="../common/img/shapes/Fixed_Shape_2_SVG/Fixed_Shape_2_CapgeminiBlue_RGB.svg">
                <h3 class="white">pact / consumer</h3>

                <img height="400em" class="no-background no-border no-margin no-shadow" src="./img/pact-consumer.JPG">
                <!--Image taken from FT Testing days presentation -->
            </section>
            <section data-transition="slide"
                     data-background-image="../common/img/shapes/Fixed_Shape_2_SVG/Fixed_Shape_2_CapgeminiBlue_RGB.svg">
                <h3 class="white">pact / provider</h3>

                <img height="400em" class="no-background no-border no-margin no-shadow" src="./img/pact-provider.JPG">
                <!--Image taken from FT Testing days presentation -->
            </section>
            <section data-transition="slide"
                     data-background-image="../common/img/shapes/Fixed_Shape_2_SVG/Fixed_Shape_2_CapgeminiBlue_RGB.svg">
                <h3 class="white">consumer code (java spring)</h3>

                <body class="white">
                <pre style="margin: 0; width: 100%"><code class="hljs ts" data-trim>
@RunWith(SpringRestPactRunner.class)
@Provider("book-service")
@PactFolder("pacts")
@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT)
public class ContractTest {

  @TestTarget
  public final Target target = new SpringBootHttpTarget();

  @State("Books exist")
  public void user1Exists() {
    // nothing to do, real service is used
  }
}
            </code></pre>
                </body>
            </section>
        </section>

        <!-- Router Events -->
        <!--<section>
            <section id="routerEventsHowTo" data-transition="slide"
            data-background-image="../common/img/shapes/Fixed_Shape_3_SVG/Fixed_Shape_3_CapgeminiLightBlue_RGB.svg">
            <h2 class="white">Router Events </h2>

            <body class="white">
            <ul>
            <li>Routing Basics</li>
            <li>Feature Target</li>
            <li>Steps</li>
            </ul>
            </body>
            </section>
            <section data-transition="slide"
            data-background-image="../common/img/shapes/Fixed_Shape_3_SVG/Fixed_Shape_3_CapgeminiLightBlue_RGB.svg">
            <h2 class="white">Routing Basics</h2>

            <body class="white">
            <img src="img/routing.png"/>
            <small>
            <a href="https://vsavkin.com/angular-2-router-d9e30599f9ea">https://vsavkin.com/angular-2-router-d9e30599f9ea</a>
            </small>
            </body>
            </section>
            <section data-transition="slide"
            data-background-image="../common/img/shapes/Fixed_Shape_3_SVG/Fixed_Shape_3_CapgeminiLightBlue_RGB.svg">
            <h2 class="white">Feature Target</h2>

            <body class="white">
            Display a spinner in case the application is waiting for the data being loaded and seems not to be
            responding.
            </body>
            <div class="footer">
            Start Branch: 0-start
            <br>
            End Branch: 1-router-events
            </div>
            </section>
            <section data-transition="slide"
            data-background-image="../common/img/shapes/Fixed_Shape_3_SVG/Fixed_Shape_3_CapgeminiLightBlue_RGB.svg">
            <h2 class="white">Step 1</h2>

            <body class="white">
            To observe the unwanted behaviour lets add a delay to our Service.

            <pre style="margin: 0; width: 100%"><code class="hljs ts" data-trim>
            findOne(id: number): Observable&lt;Book&gt; {
            return this.http.get&lt;Book&gt;(BookService.BOOK_URI + '/' + id)
            .pipe(delay(1000));
            }
            </code></pre>
            How does the app behave now?
            </body>
            </section>
            <section data-transition="slide"
            data-background-image="../common/img/shapes/Fixed_Shape_3_SVG/Fixed_Shape_3_CapgeminiLightBlue_RGB.svg">
            <h2 class="white">Step 2</h2>

            <body class="white">
            To be sure that it is the resolve that is causing the issue lets trace it.

            <pre style="margin: 0; width: 100%"><code class="hljs ts" data-trim>
            RouterModule.forRoot(routes, { enableTracing: true }),
            </code></pre>
            See the resolve now?
            </body>
            </section>
            <section data-transition="slide"
            data-background-image="../common/img/shapes/Fixed_Shape_3_SVG/Fixed_Shape_3_CapgeminiLightBlue_RGB.svg">
            <h2 class="white">Step 3</h2>

            <body class="white">
            Lets handle the ResolveStart - ResolveEnd case and show something special

            <pre style="margin: 0; width: 100%"><code class="hljs ts" data-trim>
            export class AppComponent {
            isLoadingData = false;

            constructor(private router: Router) {
            router.events.subscribe((routerEvent: RouterEvent) => {
            this.checkRouterEvent(routerEvent);
            });
            }
            </code></pre>

            </body>
            </section>
            <section data-transition="slide"
            data-background-image="../common/img/shapes/Fixed_Shape_3_SVG/Fixed_Shape_3_CapgeminiLightBlue_RGB.svg">
            <h2 class="white">Step 4</h2>

            <body class="white">
            <pre style="margin: 0; width: 100%"><code class="hljs ts" data-trim>
            checkRouterEvent(routerEvent: RouterEvent): void {
            if (routerEvent instanceof ResolveStart) {
            this.isLoadingData = true;
            }
            if (routerEvent instanceof ResolveEnd ||
            routerEvent instanceof NavigationCancel ||
            routerEvent instanceof NavigationError) {
            this.isLoadingData = false;
            }
            }
            </code></pre>

            </body>
            </section>
            <section data-transition="slide"
            data-background-image="../common/img/shapes/Fixed_Shape_3_SVG/Fixed_Shape_3_CapgeminiLightBlue_RGB.svg">
            <h2 class="white">Step 5</h2>

            <body class="white">
            The template can now use the isLoadingData flag now.

            <pre style="margin: 0; width: 100%"><code class="hljs html" data-trim>
            <div class="loader" *ngIf="isLoadingData"></div>
            <router-outlet *ngIf="!isLoadingData"></router-outlet>
            </code></pre>

            </body>
            </section>
            <section data-transition="slide"
            data-background-image="../common/img/shapes/Fixed_Shape_3_SVG/Fixed_Shape_3_CapgeminiLightBlue_RGB.svg">
            <h2 class="white">Final Step</h2>

            <body class="white">
            Lets tweak it with some CSS

            <pre style="margin: 0; width: 100%"><code class="hljs css" data-trim>
            .loader {
            border: 16px solid #f3f3f3; /* Light grey */
            border-top: 16px solid #3498db; /* Blue */
            border-radius: 50%;
            width: 120px;
            height: 120px;
            animation: spin 2s linear infinite;
            }
            @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
            }
            </code></pre>

            </body>
            </section>
        </section>-->

    </div>
</div>


<script src="../reveal.js-3.6.0/lib/js/head.min.js"></script>
<script src="../reveal.js-3.6.0/js/reveal.js"></script>

<script>
    // More info https://github.com/hakimel/reveal.js#configuration
    Reveal.initialize({
        history: true,

        // More info https://github.com/hakimel/reveal.js#dependencies
        dependencies: [
            {
                src: '../reveal.js-3.6.0/lib/js/classList.js', condition: function () {
                    return !document.body.classList;
                }
            },
            {
                src: '../reveal.js-3.6.0/plugin/highlight/highlight.js', async: true, callback: function () {
                    hljs.initHighlightingOnLoad();
                }
            },
            {src: '../reveal.js-3.6.0/plugin/search/search.js', async: true},
            {src: '../reveal.js-3.6.0/plugin/zoom-js/zoom.js', async: true},
            {src: '../reveal.js-3.6.0/plugin/notes/notes.js', async: true}
        ]
    });
</script>
</body>

</html>
